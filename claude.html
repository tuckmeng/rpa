<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plain Text Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .toolbar {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-group {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .separator {
            width: 1px;
            height: 20px;
            background-color: #34495e;
            margin: 0 10px;
        }

        button {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #2980b9;
        }

        button:active {
            background-color: #21618c;
        }

        .search-container {
            background-color: #34495e;
            padding: 10px;
            display: none;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            border-bottom: 1px solid #2c3e50;
        }

        .search-container.active {
            display: flex;
        }

        .search-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .search-group label {
            font-size: 12px;
            color: #ecf0f1;
        }

        .search-input {
            padding: 6px;
            border: 1px solid #bdc3c7;
            border-radius: 3px;
            font-size: 12px;
            width: 200px;
        }

        .search-options {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #ecf0f1;
            font-size: 12px;
        }

        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin: 10px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .editor {
            flex: 1;
            padding: 15px;
            border: none;
            outline: none;
            resize: none;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            background-color: #fefefe;
        }

        .status-bar {
            background-color: #ecf0f1;
            padding: 5px 15px;
            font-size: 12px;
            color: #2c3e50;
            border-top: 1px solid #bdc3c7;
            display: flex;
            justify-content: space-between;
        }

        .file-input {
            display: none;
        }

        .search-highlight {
            background-color: #ffeb3b;
            color: #000;
        }

        .current-highlight {
            background-color: #ff9800;
            color: #fff;
        }

        @media (max-width: 768px) {
            .toolbar {
                padding: 5px;
            }
            
            .search-input {
                width: 150px;
            }
            
            .editor {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <div class="btn-group">
            <button onclick="newFile()">New</button>
            <button onclick="document.getElementById('fileInput').click()">Open</button>
            <button onclick="saveFile()">Save</button>
        </div>
        
        <div class="separator"></div>
        
        <div class="btn-group">
            <button onclick="toggleSearchReplace()">Find & Replace</button>
        </div>
    </div>

    <div class="search-container" id="searchContainer">
        <div class="search-group">
            <label for="searchInput">Find:</label>
            <input type="text" id="searchInput" class="search-input" placeholder="Enter search text...">
        </div>
        
        <div class="search-group">
            <label for="replaceInput">Replace:</label>
            <input type="text" id="replaceInput" class="search-input" placeholder="Enter replacement text...">
        </div>
        
        <div class="search-options">
            <div class="checkbox-group">
                <input type="checkbox" id="caseSensitive">
                <label for="caseSensitive">Case Sensitive</label>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="useRegex">
                <label for="useRegex">Regular Expression</label>
            </div>
            
            <button onclick="findNext()">Find Next</button>
            <button onclick="replaceOne()">Replace</button>
            <button onclick="replaceAll()">Replace All</button>
            <button onclick="closeSearch()">Close</button>
        </div>
    </div>

    <div class="editor-container">
        <textarea id="editor" class="editor" placeholder="Start typing your text here..."></textarea>
        <div class="status-bar">
            <span id="statusLeft">Ready</span>
            <span id="statusRight">Line 1, Column 1</span>
        </div>
    </div>

    <input type="file" id="fileInput" class="file-input" accept=".txt,.md,.js,.html,.css,.json" onchange="openFile(event)">

    <script>
        let currentFileName = 'untitled.txt';
        let searchMatches = [];
        let currentMatchIndex = -1;
        let lastSearchText = '';

        const editor = document.getElementById('editor');
        const statusLeft = document.getElementById('statusLeft');
        const statusRight = document.getElementById('statusRight');
        const searchContainer = document.getElementById('searchContainer');

        // Update cursor position
        editor.addEventListener('input', updateStatus);
        editor.addEventListener('selectionchange', updateCursorPosition);
        editor.addEventListener('keyup', updateCursorPosition);
        editor.addEventListener('click', updateCursorPosition);

        // Handle Enter key in search inputs
        document.getElementById('searchInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                findNext();
            }
        });

        document.getElementById('replaceInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                replaceOne();
            }
        });

        // Handle search input changes
        document.getElementById('searchInput').addEventListener('input', function() {
            clearHighlights();
            searchMatches = [];
            currentMatchIndex = -1;
        });

        function updateStatus() {
            const text = editor.value;
            const lines = text.split('\n').length;
            const chars = text.length;
            statusLeft.textContent = `${lines} lines, ${chars} characters`;
            updateCursorPosition();
        }

        function updateCursorPosition() {
            const text = editor.value;
            const cursorPos = editor.selectionStart;
            const textBeforeCursor = text.substring(0, cursorPos);
            const lines = textBeforeCursor.split('\n');
            const currentLine = lines.length;
            const currentColumn = lines[lines.length - 1].length + 1;
            statusRight.textContent = `Line ${currentLine}, Column ${currentColumn}`;
        }

        function newFile() {
            if (editor.value && confirm('Are you sure? Unsaved changes will be lost.')) {
                editor.value = '';
                currentFileName = 'untitled.txt';
                updateStatus();
                statusLeft.textContent = 'New file created';
            } else if (!editor.value) {
                editor.value = '';
                currentFileName = 'untitled.txt';
                updateStatus();
                statusLeft.textContent = 'New file created';
            }
        }

        function openFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    editor.value = e.target.result;
                    currentFileName = file.name;
                    updateStatus();
                    statusLeft.textContent = `Opened: ${currentFileName}`;
                };
                reader.readAsText(file);
            }
        }

        function saveFile() {
            const text = editor.value;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = currentFileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            statusLeft.textContent = `Saved: ${currentFileName}`;
        }

        function toggleSearchReplace() {
            const container = document.getElementById('searchContainer');
            if (container.classList.contains('active')) {
                closeSearch();
            } else {
                container.classList.add('active');
                document.getElementById('searchInput').focus();
            }
        }

        function closeSearch() {
            searchContainer.classList.remove('active');
            clearHighlights();
            searchMatches = [];
            currentMatchIndex = -1;
            editor.focus();
        }

        function clearHighlights() {
            // Remove any existing highlights by resetting the editor content
            const currentValue = editor.value;
            const currentPos = editor.selectionStart;
            editor.value = currentValue;
            editor.setSelectionRange(currentPos, currentPos);
        }

        function createSearchRegex(searchText) {
            const caseSensitive = document.getElementById('caseSensitive').checked;
            const useRegex = document.getElementById('useRegex').checked;
            
            let pattern;
            let flags = 'g';
            
            if (!caseSensitive) {
                flags += 'i';
            }
            
            if (useRegex) {
                try {
                    pattern = new RegExp(searchText, flags);
                } catch (e) {
                    statusLeft.textContent = 'Invalid regular expression';
                    return null;
                }
            } else {
                // Escape special regex characters for literal search
                const escapedText = searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                pattern = new RegExp(escapedText, flags);
            }
            
            return pattern;
        }

        function findMatches(searchText) {
            if (!searchText) return [];
            
            const pattern = createSearchRegex(searchText);
            if (!pattern) return [];
            
            const text = editor.value;
            const matches = [];
            let match;
            
            while ((match = pattern.exec(text)) !== null) {
                matches.push({
                    start: match.index,
                    end: match.index + match[0].length,
                    text: match[0]
                });
                
                // Prevent infinite loop on zero-length matches
                if (match.index === pattern.lastIndex) {
                    pattern.lastIndex++;
                }
            }
            
            return matches;
        }

        function findNext() {
            const searchText = document.getElementById('searchInput').value;
            if (!searchText) {
                statusLeft.textContent = 'Enter search text';
                return;
            }

            // If search text changed, find all matches from the beginning
            if (searchText !== lastSearchText) {
                searchMatches = findMatches(searchText);
                currentMatchIndex = -1;
                lastSearchText = searchText;
            }

            if (searchMatches.length === 0) {
                statusLeft.textContent = 'No matches found';
                return;
            }

            // Move to next match (always starting from line 1, column 1 for first search)
            currentMatchIndex = (currentMatchIndex + 1) % searchMatches.length;
            const match = searchMatches[currentMatchIndex];
            
            // Select the match in the editor
            editor.focus();
            editor.setSelectionRange(match.start, match.end);
            
            // Scroll to the selection
            const textBeforeMatch = editor.value.substring(0, match.start);
            const lines = textBeforeMatch.split('\n');
            const lineNumber = lines.length;
            
            statusLeft.textContent = `Match ${currentMatchIndex + 1} of ${searchMatches.length} (Line ${lineNumber})`;
        }

        function replaceOne() {
            const searchText = document.getElementById('searchInput').value;
            const replaceText = document.getElementById('replaceInput').value;
            
            if (!searchText) {
                statusLeft.textContent = 'Enter search text';
                return;
            }

            // If no current selection or selection doesn't match search, find next
            const selectedText = editor.value.substring(editor.selectionStart, editor.selectionEnd);
            const pattern = createSearchRegex(searchText);
            
            if (!pattern) return;
            
            let shouldReplace = false;
            if (selectedText) {
                if (document.getElementById('useRegex').checked) {
                    shouldReplace = pattern.test(selectedText);
                } else {
                    const caseSensitive = document.getElementById('caseSensitive').checked;
                    shouldReplace = caseSensitive ? 
                        selectedText === searchText : 
                        selectedText.toLowerCase() === searchText.toLowerCase();
                }
            }

            if (shouldReplace) {
                // Replace selected text
                const start = editor.selectionStart;
                const end = editor.selectionEnd;
                const beforeText = editor.value.substring(0, start);
                const afterText = editor.value.substring(end);
                
                let replacement = replaceText;
                if (document.getElementById('useRegex').checked) {
                    replacement = selectedText.replace(pattern, replaceText);
                }
                
                editor.value = beforeText + replacement + afterText;
                editor.setSelectionRange(start, start + replacement.length);
                
                // Update search matches since text changed
                searchMatches = findMatches(searchText);
                currentMatchIndex = -1;
                
                statusLeft.textContent = 'Text replaced';
                updateStatus();
            }
            
            // Find next match
            findNext();
        }

        function replaceAll() {
            const searchText = document.getElementById('searchInput').value;
            const replaceText = document.getElementById('replaceInput').value;
            
            if (!searchText) {
                statusLeft.textContent = 'Enter search text';
                return;
            }

            const pattern = createSearchRegex(searchText);
            if (!pattern) return;

            const lines = editor.value.split('\n');
            let totalReplacements = 0;
            let linesChanged = 0;
            
            // Process each line individually
            for (let i = 0; i < lines.length; i++) {
                const originalLine = lines[i];
                const newLine = originalLine.replace(pattern, replaceText);
                
                if (newLine !== originalLine) {
                    lines[i] = newLine;
                    linesChanged++;
                    
                    // Count replacements in this line
                    const lineMatches = (originalLine.match(pattern) || []).length;
                    totalReplacements += lineMatches;
                }
            }
            
            if (totalReplacements > 0) {
                editor.value = lines.join('\n');
                statusLeft.textContent = `Replaced ${totalReplacements} occurrence(s) in ${linesChanged} line(s)`;
                updateStatus();
                
                // Clear search state
                searchMatches = [];
                currentMatchIndex = -1;
                lastSearchText = '';
            } else {
                statusLeft.textContent = 'No matches found to replace';
            }
            
            // Move cursor to beginning
            editor.setSelectionRange(0, 0);
            editor.focus();
        }

        // Initialize
        updateStatus();
    </script>
</body>
</html>